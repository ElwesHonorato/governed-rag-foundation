services:
  rag-api:
    build:
      context: ./apps/rag-api
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      WEAVIATE_URL: http://weaviate:8080
      REDIS_URL: redis://redis:6379/0
      S3_ENDPOINT: http://minio:9000
      S3_ACCESS_KEY: minio
      S3_SECRET_KEY: minio123
      MARQUEZ_URL: http://marquez:5000
      MARQUEZ_LINEAGE_URL: http://marquez:5000/api/v1/lineage
      LLM_URL: http://ollama:11434
      LLM_MODEL: llama3.2:1b

  pipeline-worker:
    build:
      context: ./apps/pipeline-worker
      dockerfile: Dockerfile
    environment:
      WEAVIATE_URL: http://weaviate:8080
      REDIS_URL: redis://redis:6379/0
      S3_ENDPOINT: http://minio:9000
      S3_ACCESS_KEY: minio
      S3_SECRET_KEY: minio123
      MARQUEZ_URL: http://marquez:5000
      MARQUEZ_LINEAGE_URL: http://marquez:5000/api/v1/lineage
      LLM_URL: http://ollama:11434
      LLM_MODEL: llama3.2:1b

networks:
  default:
    external: true
    name: rag-local
