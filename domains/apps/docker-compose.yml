services:
  rag-api:
    build:
      context: ./apps/rag-api
      dockerfile: Dockerfile
    ports:
      - "${RAG_API_PORT}:8000"
    environment:
      WEAVIATE_URL: ${WEAVIATE_URL}
      REDIS_URL: ${REDIS_URL}
      S3_ENDPOINT: ${S3_ENDPOINT}
      S3_ACCESS_KEY: ${S3_ACCESS_KEY}
      S3_SECRET_KEY: ${S3_SECRET_KEY}
      MARQUEZ_URL: ${MARQUEZ_URL}
      MARQUEZ_LINEAGE_URL: ${MARQUEZ_LINEAGE_URL}
      LLM_URL: ${LLM_URL}
      LLM_MODEL: ${LLM_MODEL}
      LLM_TIMEOUT_SECONDS: ${LLM_TIMEOUT_SECONDS}

  pipeline-worker:
    build:
      context: ./apps/pipeline-worker
      dockerfile: Dockerfile
    environment:
      WEAVIATE_URL: ${WEAVIATE_URL}
      REDIS_URL: ${REDIS_URL}
      S3_ENDPOINT: ${S3_ENDPOINT}
      S3_ACCESS_KEY: ${S3_ACCESS_KEY}
      S3_SECRET_KEY: ${S3_SECRET_KEY}
      MARQUEZ_URL: ${MARQUEZ_URL}
      MARQUEZ_LINEAGE_URL: ${MARQUEZ_LINEAGE_URL}
      LLM_URL: ${LLM_URL}
      LLM_MODEL: ${LLM_MODEL}
      LLM_TIMEOUT_SECONDS: ${LLM_TIMEOUT_SECONDS}

networks:
  default:
    external: true
    name: ${STACK_NETWORK}
