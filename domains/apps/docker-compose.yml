services:
  rag-api:
    build:
      context: ./apps/rag-api
      dockerfile: Dockerfile
    ports:
      - "${RAG_API_PORT:?RAG_API_PORT is required}:8000"
    environment:
      WEAVIATE_URL: ${WEAVIATE_URL:?WEAVIATE_URL is required}
      REDIS_URL: ${REDIS_URL:?REDIS_URL is required}
      S3_ENDPOINT: ${S3_ENDPOINT:?S3_ENDPOINT is required}
      S3_BUCKET: ${S3_BUCKET:?S3_BUCKET is required}
      S3_ACCESS_KEY: ${S3_ACCESS_KEY:?S3_ACCESS_KEY is required}
      S3_SECRET_KEY: ${S3_SECRET_KEY:?S3_SECRET_KEY is required}
      MARQUEZ_URL: ${MARQUEZ_URL:?MARQUEZ_URL is required}
      MARQUEZ_LINEAGE_URL: ${MARQUEZ_LINEAGE_URL:?MARQUEZ_LINEAGE_URL is required}
      LLM_URL: ${LLM_URL:?LLM_URL is required}
      LLM_MODEL: ${LLM_MODEL:?LLM_MODEL is required}
      LLM_TIMEOUT_SECONDS: ${LLM_TIMEOUT_SECONDS:?LLM_TIMEOUT_SECONDS is required}

  pipeline-worker:
    build:
      context: ./apps/pipeline-worker
      dockerfile: Dockerfile
    environment:
      WEAVIATE_URL: ${WEAVIATE_URL:?WEAVIATE_URL is required}
      REDIS_URL: ${REDIS_URL:?REDIS_URL is required}
      S3_ENDPOINT: ${S3_ENDPOINT:?S3_ENDPOINT is required}
      S3_BUCKET: ${S3_BUCKET:?S3_BUCKET is required}
      S3_ACCESS_KEY: ${S3_ACCESS_KEY:?S3_ACCESS_KEY is required}
      S3_SECRET_KEY: ${S3_SECRET_KEY:?S3_SECRET_KEY is required}
      MARQUEZ_URL: ${MARQUEZ_URL:?MARQUEZ_URL is required}
      MARQUEZ_LINEAGE_URL: ${MARQUEZ_LINEAGE_URL:?MARQUEZ_LINEAGE_URL is required}
      LLM_URL: ${LLM_URL:?LLM_URL is required}
      LLM_MODEL: ${LLM_MODEL:?LLM_MODEL is required}
      LLM_TIMEOUT_SECONDS: ${LLM_TIMEOUT_SECONDS:?LLM_TIMEOUT_SECONDS is required}

networks:
  default:
    external: true
    name: ${STACK_NETWORK:?STACK_NETWORK is required}
